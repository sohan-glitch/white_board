<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fixed Whiteboard with Lasso Tool</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: white;
  cursor: crosshair;
}
/* Toolbar */
.toolbar {
  position: fixed;
  bottom: 20px;
  left: 20px;
  display: flex;
  align-items: center;
  transition: all 0.4s ease;
}
.toolbox {
  display: flex;
  opacity: 0;
  pointer-events: none;
  transform: translateX(-20px);
  background: rgba(255,255,255,0.95);
  border-radius: 12px;
  padding: 10px 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  gap: 10px;
  transition: all 0.4s ease;
}
.toolbar.expanded .toolbox {
  opacity: 1;
  pointer-events: auto;
  transform: translateX(0);
}
.toggle-btn {
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  font-size: 22px;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
  transition: transform 0.3s ease, background-color 0.3s ease;
}
.toggle-btn:hover {
  background-color: #0056b3;
  transform: rotate(90deg);
}
button, input[type="color"], input[type="range"] {
  cursor: pointer;
}
button {
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background: #f8f8f8;
  transition: background 0.3s ease;
}
button:hover {
  background: #e0e0e0;
}
label {
  font-size: 12px;
  color: #333;
  margin-right: 4px;
}
.tool {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
}
.lasso-menu {
  position: absolute;
  display: none;
  flex-direction: row;
  gap: 6px;
  background: rgba(255,255,255,0.95);
  border-radius: 8px;
  padding: 5px 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<canvas id="whiteboard"></canvas>

<div class="toolbar" id="toolbar">
  <button class="toggle-btn" id="toggleMenu">‚¨Ü</button>
  <div class="toolbox" id="toolbox">
    <div class="tool">
      <label>Pen</label>
      <input type="color" id="penColorPicker" value="#000000">
      <button id="applyPen">Done</button>
    </div>
    <div class="tool">
      <label>BG</label>
      <input type="color" id="bgColorPicker" value="#ffffff">
      <button id="applyBG">Done</button>
    </div>
    <div class="tool">
      <label>Pen Size</label>
      <input type="range" id="penSize" min="1" max="50" value="5">
    </div>
    <div class="tool">
      <label>Eraser Size</label>
      <input type="range" id="eraserSize" min="5" max="100" value="30">
    </div>
    <button id="penBtn">‚úèÔ∏è Pen</button>
    <button id="eraseBtn">üßΩ Eraser</button>
    <button id="lassoBtn">‚úÇÔ∏è Lasso</button>
  </div>
</div>

<div class="lasso-menu" id="lassoMenu">
  <button id="moveBtn">Move</button>
  <button id="deleteBtn">Delete</button>
  <button id="resizeBtn">Resize</button>
</div>

<script>
const canvas = document.getElementById('whiteboard');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let drawing = false, eraseMode = false, lassoMode = false;
let currentColor = '#000000';
let bgColor = '#ffffff';
let penSize = 5, eraserSize = 30;
let lastX = 0, lastY = 0;

// selection
let selectionPath = [];
let selectionImage = null;
let selectionBounds = null;
let tempCanvas = document.createElement('canvas');
let tctx = tempCanvas.getContext('2d');
tempCanvas.width = canvas.width;
tempCanvas.height = canvas.height;
let baseImage = null;

function fillBackground() {
  ctx.fillStyle = bgColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
fillBackground();

// Draw / erase
function draw(e){
  if(!drawing || lassoMode) return;
  ctx.lineCap='round'; ctx.lineJoin='round';
  ctx.beginPath();
  ctx.moveTo(lastX,lastY);
  if(eraseMode){
    ctx.globalCompositeOperation='destination-out';
    ctx.lineWidth=eraserSize;
  } else {
    ctx.globalCompositeOperation='source-over';
    ctx.strokeStyle=currentColor;
    ctx.lineWidth=penSize;
  }
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
  ctx.closePath();
  [lastX,lastY]=[e.offsetX,e.offsetY];
}

// Draw lasso overlay on tempCanvas (not main)
function drawLasso(e){
  if(!lassoMode || !drawing) return;
  tctx.clearRect(0,0,tempCanvas.width,tempCanvas.height);
  tctx.strokeStyle='#007bff';
  tctx.setLineDash([6,4]);
  tctx.beginPath();
  tctx.moveTo(selectionPath[0][0],selectionPath[0][1]);
  selectionPath.forEach(p=>tctx.lineTo(p[0],p[1]));
  tctx.lineTo(e.offsetX,e.offsetY);
  tctx.stroke();
  tctx.setLineDash([]);
}

canvas.addEventListener('mousedown',e=>{
  drawing=true;
  [lastX,lastY]=[e.offsetX,e.offsetY];
  if(lassoMode){
    selectionPath=[[e.offsetX,e.offsetY]];
    baseImage=ctx.getImageData(0,0,canvas.width,canvas.height);
  }
});
canvas.addEventListener('mousemove',e=>{
  if(lassoMode){
    selectionPath.push([e.offsetX,e.offsetY]);
    drawLasso(e);
    redraw();
  } else draw(e);
});
canvas.addEventListener('mouseup',e=>{
  if(lassoMode){
    finalizeLasso();
  }
  drawing=false;
});
canvas.addEventListener('mouseout',()=>drawing=false);

function redraw(){
  ctx.putImageData(baseImage,0,0);
  ctx.drawImage(tempCanvas,0,0);
}

function finalizeLasso(){
  if(selectionPath.length<3) return;
  const xs=selectionPath.map(p=>p[0]);
  const ys=selectionPath.map(p=>p[1]);
  const minX=Math.min(...xs),maxX=Math.max(...xs);
  const minY=Math.min(...ys),maxY=Math.max(...ys);
  const w=maxX-minX, h=maxY-minY;
  selectionBounds={x:minX,y:minY,w,h};
  selectionImage=ctx.getImageData(minX,minY,w,h);
  showLassoMenu(minX+w/2,minY+h/2);
  tctx.clearRect(0,0,tempCanvas.width,tempCanvas.height);
  redraw();
}

function showLassoMenu(x,y){
  const menu=document.getElementById('lassoMenu');
  menu.style.display='flex';
  menu.style.left=`${x}px`;
  menu.style.top=`${y}px`;
}
function hideLassoMenu(){
  document.getElementById('lassoMenu').style.display='none';
}

document.getElementById('moveBtn').addEventListener('click',()=>{
  if(!selectionImage)return;
  hideLassoMenu();
  moveSelection();
});
document.getElementById('deleteBtn').addEventListener('click',()=>{
  if(!selectionBounds)return;
  ctx.clearRect(selectionBounds.x,selectionBounds.y,selectionBounds.w,selectionBounds.h);
  hideLassoMenu();
});
document.getElementById('resizeBtn').addEventListener('click',()=>{
  if(!selectionImage)return;
  hideLassoMenu();
  resizeSelection();
});

function moveSelection(){
  let moving=true;
  function move(e){
    if(!moving)return;
    ctx.putImageData(baseImage,0,0);
    ctx.putImageData(selectionImage,e.offsetX-selectionBounds.w/2,e.offsetY-selectionBounds.h/2);
  }
  function end(e){
    moving=false;
    ctx.putImageData(baseImage,0,0);
    ctx.putImageData(selectionImage,e.offsetX-selectionBounds.w/2,e.offsetY-selectionBounds.h/2);
    canvas.removeEventListener('mousemove',move);
    canvas.removeEventListener('mouseup',end);
  }
  canvas.addEventListener('mousemove',move);
  canvas.addEventListener('mouseup',end);
}
function resizeSelection(){
  let resizing=true;
  function resize(e){
    if(!resizing)return;
    const scaleX=(e.offsetX-selectionBounds.x)/selectionBounds.w;
    const scaleY=(e.offsetY-selectionBounds.y)/selectionBounds.h;
    const temp=document.createElement('canvas');
    temp.width=selectionImage.width;
    temp.height=selectionImage.height;
    temp.getContext('2d').putImageData(selectionImage,0,0);
    ctx.putImageData(baseImage,0,0);
    ctx.drawImage(temp,selectionBounds.x,selectionBounds.y,selectionBounds.w*scaleX,selectionBounds.h*scaleY);
  }
  function end(){
    resizing=false;
    canvas.removeEventListener('mousemove',resize);
    canvas.removeEventListener('mouseup',end);
  }
  canvas.addEventListener('mousemove',resize);
  canvas.addEventListener('mouseup',end);
}

// Toolbar
const toolbar=document.getElementById('toolbar');
document.getElementById('toggleMenu').addEventListener('click',()=>{
  toolbar.classList.toggle('expanded');
  document.getElementById('toggleMenu').textContent=toolbar.classList.contains('expanded')?'‚¨á':'‚¨Ü';
});

// Tools
document.getElementById('penBtn').addEventListener('click',()=>{
  eraseMode=false;lassoMode=false;canvas.style.cursor='crosshair';
});
document.getElementById('eraseBtn').addEventListener('click',()=>{
  eraseMode=!eraseMode;lassoMode=false;canvas.style.cursor=eraseMode?'cell':'crosshair';
});
document.getElementById('lassoBtn').addEventListener('click',()=>{
  lassoMode=!lassoMode;eraseMode=false;canvas.style.cursor=lassoMode?'crosshair':'default';
});

// Color buttons
let tempPenColor=currentColor;
let tempBGColor=bgColor;
document.getElementById('penColorPicker').addEventListener('input',e=>tempPenColor=e.target.value);
document.getElementById('applyPen').addEventListener('click',()=>currentColor=tempPenColor);
document.getElementById('bgColorPicker').addEventListener('input',e=>tempBGColor=e.target.value);
document.getElementById('applyBG').addEventListener('click',()=>{
  bgColor=tempBGColor;
  canvas.style.backgroundColor=bgColor;
});

// size
document.getElementById('penSize').addEventListener('input',e=>penSize=e.target.value);
document.getElementById('eraserSize').addEventListener('input',e=>eraserSize=e.target.value);
</script>
</body>
</html>
